@{
    ViewBag.Title = "Create";
    Layout = "~/Areas/Administration/Views/Shared/_Layout.cshtml";
}
@Scripts.Render("~/Bundles/jquery.validate")
@Scripts.Render("~/Content/ckeditor/ckeditor.js")

<script>
    @*var categories = @Html.Raw(Json.Encode(ViewBag.CategoryId))*@
</script>
<style>
    
</style>
<div class="box" style="">
    <div class="tab-header">
        Tạo mới danh mục
    </div>
    <form class="fill-up" id="createCategory" method="post">
        <div class="row-fluid">
            <div class="span6">
                <div class="padded">
                    <div class="input">
                        <label for="categoryName">Tên danh mục</label>
                        <input id="categoryName" name="CategoryName" type="text" />
                    </div>
                    <div class="input">
                        <label for="categoryParentName">Danh mục cha</label>
                        @*@Html.DropDownList("CategoryId", (SelectList)ViewBag.CategoryId, new { id = "category", name = "CategoryId", style = "width:100%"})*@
                        <input id="categoryParentName" name="CategoryParentName" type="text" />
                    </div>
                    <div class="input">
                        <label for="status">Status</label>
                        @*@Html.DropDownList("CategoryStatus", (SelectList)ViewBag.CategoryStatus, new { id = "category", name = "CategoryStatus"})*@
                        @*<input id="status" type="" class="" name="Status"/>*@
                        <div align ="center">
                        <input id="statusActive" type="radio" name="groupActive" value="1" checked> Active<br>
                        <input id="statusDeactive" type="radio" name="groupActive" value="2"> Deactive<br>
                            </div>
                    </div>
                    <div class="input">
                        <label for="description">Chú thích</label>
                        <textarea name="Description" id="description" style="width: 100%; height: 100px;" class=""></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-actions">
            <button type="submit" class="button blue">Lưu</button>
            <a href="@Url.Action("Index")" class="button">Hủy</a>
            @*<div class="pull-right">
                <span class="checky-label-left">
                  Đăng sự kiện
                </span>
                <input type="checkbox" name="isApprove" id="approve" checked="checked" class="checky">
                <label for="approve" class="checky"><span></span></label>
              </div>*@
        </div>
    </form>
</div>
<script>
    CKEDITOR.replace('description', {
        toolbar: [
		{ name: 'clipboard', items: ['Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo'] },
		{ name: 'editing', items: ['Find', 'Replace', '-', 'SelectAll', '-', 'Scayt'] },
		{
		    name: 'insert', items: ['Image', 'Table', 'HorizontalRule', 'Smiley', 'SpecialChar', 'PageBreak']
		},
                '/',
		{ name: 'styles', items: ['Styles', 'Format'] },
		{ name: 'basicstyles', items: ['Bold', 'Italic', 'Strike', '-', 'RemoveFormat'] },
		{ name: 'paragraph', items: ['NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote'] },
		{ name: 'links', items: ['Link', 'Unlink', 'Anchor'] },
		{ name: 'tools', items: ['Maximize', '-', 'About'] }
        ]
    })

    validateOptions = {
        rules: {
            CategoryName: {
                required: true
            },
            CategoryParentName: {
                required: true
            }
        },
        messages: {
            CategoryName: "Cần phải điền tên danh mục",
            CategoryParentName: "Phải chọn tên danh mục cha"
        }
        ////,
        ////errorLabelContainer:$('.validation-summary-errors')
        //, errorElement: "span",
        //errorClass: "error",
        //errorPlacement: function (error, element) {
        //    error.insertAfter(element.parent().find("label"));
        //},
        //ignore: ".select2-focusser,.select2-input"
    }

    $("#createCategory").validate(validateOptions);

    function submit() {
        Loading(true, true);
        $("#description").val(CKEDITOR.instances.description.getData());
        var formData = new FormData($("#createCategory")[0]);

        function success(rs) {
            Loading(false);
            if (rs.Result && rs.Result == "OK") {
                location = Url({ Action: "Index" })
            } else {
                $.fn.dialog2.helpers.alert("Lỗi: " + rs.Message);
            }
        }
        $.ajax({
            url: Url({ Action: "Create" }),
            type: "POST",
            data: formData,
            success: success,
            processData: false,
            contentType: false,
        });

    }
    $("#createCategory").submit(function (e) {
        if ($("#createCategory").valid()) {
            submit();
            return false;
        }
    })
</script>
