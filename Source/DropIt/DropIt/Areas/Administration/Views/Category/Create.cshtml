@{
    ViewBag.Title = "Create";
    Layout = "~/Areas/Administration/Views/Shared/_Layout.cshtml";
}
@Scripts.Render("~/Bundles/jquery.validate")
@Scripts.Render("~/Content/ckeditor/ckeditor.js")

<style>
    label {
        font-weight: bold;
    }

    .input {
        margin-top: 15px;
    }
</style>
<div class="box" style="">
    <div class="tab-header">
        Tạo mới danh mục
    </div>
    <form class="fill-up" id="createEvent" method="post" enctype="multipart/form-data">
        <div class="row-fluid">
            <div class="span6">
                <div class="padded">
                    <div class="input">
                        <label for="categoryName">Tên danh mục</label>
                        <input id="categoryName" name="CategoryName" type="text" />
                    </div>
                    <div class="input">
                        <label for="categoryParentName">Danh mục cha</label>
                        @Html.DropDownList("ParentCategoryId", (SelectList)ViewBag.CategoryId, new { id = "category", name = "CategoryId", style = "width:100%" })
                    </div>
                </div>
            </div>
            <div class="span6">
                <div class="padded">
                    <div class="input">
                        <label for="description">Chú thích</label>
                        <textarea name="Description" id="description" style="width: 100%; height: 100px;"></textarea>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-actions">
            <button type="submit" class="button blue">Tạo mới</button>
            <a href="@Url.Action("Index")" class="button">Hủy</a>
        </div>
    </form>
</div>
<script>
    CKEDITOR.replace('description', {
        toolbar: [
		{ name: 'clipboard', items: ['Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo'] },
		{ name: 'editing', items: ['Find', 'Replace', '-', 'SelectAll', '-', 'Scayt'] },
		{
		    name: 'insert', items: ['Image', 'Table', 'HorizontalRule', 'Smiley', 'SpecialChar', 'PageBreak']
		},
                '/',
		{ name: 'styles', items: ['Styles', 'Format'] },
		{ name: 'basicstyles', items: ['Bold', 'Italic', 'Strike', '-', 'RemoveFormat'] },
		{ name: 'paragraph', items: ['NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote'] },
		{ name: 'links', items: ['Link', 'Unlink', 'Anchor'] },
		{ name: 'tools', items: ['Maximize', '-', 'About'] }
        ]
    })

    validateOptions = {
        rules: {
            CategoryName: {
                required: true
            }
        },
        messages: {
            CategoryName: "Cần phải điền tên danh mục",
        }
        //,
        //errorLabelContainer:$('.validation-summary-errors')
        , errorElement: "span",
        errorClass: "error",
        errorPlacement: function (error, element) {
            error.insertAfter(element.parent().find("label"));
        },
        ignore: ".select2-focusser,.select2-input"
    }

    $("#createEvent").validate(validateOptions);
    $("#category").select2();
    
    function submit() {
        Loading(true, true);
        $("#description").val(CKEDITOR.instances.description.getData());
        var formData = new FormData($("#createEvent")[0]);
        function success(rs) {
            Loading(false);
            if (rs.Result && rs.Result == "OK") {
                location = Url({ Action: "Index" })
            } else {
                $.fn.dialog2.helpers.alert("Lỗi: " + rs.Message);
            }
        }
        $.ajax({
            url: Url({ Action: "Create" }),
            type: "POST",
            data: formData,
            success: success,
            processData: false,
            contentType: false,
            error: function () {
                Loading(false);
                $.fn.dialog2.helpers.alert("Có lỗi xảy ra khi gửi dữ liệu lên server");
            }
        });

    }
    $("#createEvent").submit(function (e) {
        if ($("#createEvent").valid()) {
            submit();
            return false;
        }
    })
</script>
