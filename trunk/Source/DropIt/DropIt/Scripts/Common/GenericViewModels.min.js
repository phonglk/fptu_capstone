(function(){var n,t,i=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};t={getAll:{action:"Get"},"delete":{action:"Delete"},detail:{action:"Details"},edit:{action:"Update"}},n=function(){function n(n){var r=this,u;this.itemViewModel=n.itemViewModel,this.bindingTarget=n.bindingTarget,this.routing=n.routing,this.entityMapping=n.entityMapping,u=this,this.self=this,this.routing=$.extend({},t,this.routing),this.data=ko.observableArray([]),this.currentItemDetail=ko.observable({}),this._hooks={},this._filters={},this.hookRegister=function(n,t){return r._hooks[n]=t},this.callHook=function(n,t){if(r._hooks[n])return t||(t=r),r._filters[n].call(t)},this.filterRegister=function(n,t){return r._filters[n]=t},this.callFilter=function(n,t,i){return r._filters[n]?(i||(i=r),r._filters[n].call(i,t)):t},this.getItemId=function(n){return n[r.entityMapping.Id.keyName]},this.reorderFieldByIndex=function(n){var e,o,t,i,u,f,s,h;e={},i=-1,s=r.entityMapping;for(t in s)(u=s[t],t!=="Id")&&u[n].index>i&&(i=u[n].index);for(o=f=1;1<=i?f<=i:f>=i;o=1<=i?++f:--f){h=r.entityMapping;for(t in h)(u=h[t],t!=="Id")&&u[n].index===o&&(e[t]=r.entityMapping[t])}return e.Id=r.entityMapping.Id,e},this.validateEntityMapping=function(){var o,a,e,n,v,t,f,u,s,h,c,l;if(r.data().length>0){r.callHook("BeforeValidateEntityMapping"),o=[],h=r.entityMapping;for(n in h)u=h[n],o.push(n);f=r.data()[0],delete f.self,delete f.constructor;for(n in f)(u=f[n],f.hasOwnProperty(n))&&r.entityMapping.Id.keyName!==n&&(i.call(o,n)>=0||(r.entityMapping[n]={}));s=0,c=r.entityMapping,l=[];for(n in c)(u=c[n],s++,n!=="Id")&&(u.originalType?t=r.entitMapping.originalType:(t=typeof f[n],(t!=="string"||t!=="number")&&f[n]instanceof Date&&(t="datetime")),v=u.label?u.label:n,e=u.index?u.index:s,a={originalType:t,label:v,index:e,list:{allow:!0,index:e,type:t},detail:{allow:!0,index:e,type:t},edit:{allow:!0,index:e,type:t}},r.entityMapping[n]=$.extend({},a,u),l.push(r.callHook("AfterValidateEntityMapping")));return l}},this.getAll=function(){var n;loading(!0),r.callHook("BeforeGetAllItems"),n=Url({Action:r.routing.getAll.action}),$.ajax({url:n,dataType:"json",success:function(n){var u,t,f,e,i;if(loading(!1),((e=n.Result)!=null?e.length:void 0)>0){for(i=n.Result,t=0,f=i.length;t<f;t++)u=i[t],r.data.push(new r.itemViewModel(u));r.callHook("AfterGetAllItems"),r.validateEntityMapping(),ko.applyBindings(r,r.bindingTarget)}}})},this.deleteItem=function(n){var t;return t=n[r.entityMapping.Id.keyName],t?r["delete"](n):alert("Not found '"+r.entityMapping.Id+"'")},this["delete"]=function(n){var t,i,u,f;r.callHook("BeforeDeleteItem"),f=Url({Action:r.routing["delete"].action}),i=r.entityMapping.Id.requestName,u=n[r.entityMapping.Id.keyName],t={},t[i]=u,t=toFormData(t),$.ajax({url:f,type:"post",dataType:"json",data:t,success:function(t){return t.IsOK!=null==!0?r.afterDelete({isSuccess:!0,item:n}):r.afterDelete({isSuccess:!1,item:n})}})},this.afterDelete=function(n){var t,i;return t=n.isSuccess,i=n.item,t===!0?(r.data.remove(i),r.callHook("AfterDeleteItemSuccess",r)):(alert("Deletion not complete"),r.callHook("AfterDeleteItemFail",r)),r.callHook("AfterDeleteItem",r)},this.detailItem=function(n){var u,e,i,t,o,s,f;if(!r.$editModal){u=r.reorderFieldByIndex("detail"),i="";for(t in u)(f=u[t],t!=="Id")&&(i+='<div class="detail-row">\n    <span class="span5 detail-label">'+f.label+" :<\/span>\n",i+=f.detail.type==="datetime"?'    <span class="span7 detail-data" data-bind=\'date: '+t+"'><\/span>\n<\/div>":'    <span class="span7 detail-data" data-bind=\'text: '+t+"'><\/span>\n<\/div>");o='<div class="row-fluid area-detail">\n        '+i+"\n<\/div>",e='                <button type="button" data-dismiss="modal" class="btn btn-danger" data-bind="click: root.editItem">Edit<\/button>\n<button type="button" data-dismiss="modal" class="btn btn-primary">Ok<\/button>',s=modalFactory({bodyHTML:o,headerText:"Detail "+r.entityMapping.Id.keyName+" <strong>#<span data-bind='text: "+r.entityMapping.Id.keyName+"'><\/span><\/strong>",footerHTML:e,id:"editModal"}),r.$editModal=r.callFilter("EditModalHTMLCreationAfter",$(s)),$(document.body).append(r.$editModal)}return r.currentItemDetail=n,r.currentItemDetail.root=r,ko.applyBindings(r.currentItemDetail,r.$editModal[0]),r.$editModal.modal()},this.detail=function(){},this.editItem=function(){},this.edit=function(){}}return n}(),window.BaseViewModel=n}).call(this)